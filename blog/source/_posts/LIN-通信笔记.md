---
title: LIN 通信笔记
date: 2021-12-28 11:35:57
tags:
- LIN
- 汽车电子
categories:
- 工作笔记
---

## 1.开关LIN线发送唤醒信号

平台:AVR64DA32

开关睡眠后，需要可以检测按键信号，和LIN RX信号，若检测到信号，则发送唤醒

### 1.1.思路

- 开关使用RTC时钟睡眠后周期性唤醒一段时间，用来检测按键信号
- LIN RX引脚设置为GPIO中断，作为睡眠唤醒源

### 1.2.总线进入睡眠

1. 4S-10S总线未变化
2. 接收到LIN 0x3C帧第一个字节为0x00

### 1.3.开关唤醒

#### 1.3.1.什么是唤醒信号

**从节点唤醒信号的检测**
当检测到显性电平大于150us时，进入正常工作模式

**从节点如何发送唤醒信号**
从节点发送250us-5ms的唤醒信号，如果150-250ms内没有接收到第一帧数据，则重新发送唤醒信号，共持续发送3次
三次未进入正常工作模式后，必须等待1.5s之后才能再次发送

#### 1.3.2.开关退出睡眠

1. 接收到唤醒命令
2. 电容按键触发后发送唤醒信号，总线激活后

### 1.4.AVR芯片添加睡眠唤醒功能注意事项

#### 1.4.1.mcu的几种工作模式

活动，三种睡眠(空闲，待机，掉电)

#### 1.4.2.掉电模式唤醒源

1. RTC时钟可以运行，但是只有PIT功能可用。
2. 只有完全异步引脚才能触发中断并从所有睡眠模式中唤醒设备。所有引脚都可以用于外部中断，其中每个端口的Px2和Px6引脚都有完整的异步检测。-->LIN rx引脚需要不能使用2-6之外的端口作为唤醒源

#### 1.4.3.官方睡眠唤醒参考工程

[此链接2021-12-28日有效](https://github.com/microchip-pic-avr-examples/avr128da48-led-blink-sleep-example/blob/master/avr128da48-led-blink-sleep-example/AVRDA_LED_blink_sleep/main.c)

