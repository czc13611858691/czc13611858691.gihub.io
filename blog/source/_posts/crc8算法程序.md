---
title: crc8算法程序
date: 2021-12-21 17:52:10
tags:
- crc8
categories:
- miscellaneous
---

## 1.源程序来源

[CRC-8-SAE J1850 的校验程序](https://blog.csdn.net/qwe775208732/article/details/51810037)

X8 + X4 + X3 + X2 + 1 (0x1D), with a seed value of 0xFF and a final XOR value of 0xFF (CRC-8-SAE-J1850).

初始化种子值为0xff

最后异或值是0xff

```
/* (CRC-8-SAE-J1850)算法 计算结果可以通过网页验证 */
unsigned char crc8_msb(unsigned char poly, unsigned char* data, int size)
{
    /* crc初始化种子值0xff */
	unsigned char crc = 0xff;
	int bit;

	while (size--) {
		crc ^= *data++;
		for (bit = 0; bit < 8; bit++) {
			if (crc & 0x80) {
				crc = (crc << 1) ^ poly;
			} else {
				crc <<= 1;
			}
		}
	}

    /* 最终异或值 */
	return crc^0xff;
}
```



## 2.查表法

为了加快速度采用查表法

[参考文章](https://www.jianshu.com/p/f0c68eebb8a1)

```
int main(void)
{
    char data = 0;
    unsigned char poly;

    // x8 + x4 + x3 + x2 + 1 -> 0x1D
    poly = 0x1D;
    // printf("%02x\n", crc8_lsb(poly, &data, 1));
    for (uint16_t i = 0; i < 256; i++)
    {
        data = (uint8_t)i;
        printf("0x%02x,", crc8_msb(poly, &data, 1));
    }

    return 0;
}
```

生成如下数组

```
static const unsigned int crc8Table[256] =
{
0x3b,0x26,0x01,0x1c,0x4f,0x52,0x75,0x68,0xd3,0xce,0xe9,0xf4,0xa7,0xba,0x9d,0x80,0xf6,0xeb,0xcc,0xd1,0x82,0x9f,0xb8,0xa5,0x1e,0x03,0x24,0x39,0x6a,0x77,0x50,0x4d,0xbc,0xa1,0x86,0x9b,0xc8,0xd5,0xf2,0xef,0x54,0x49,0x6e,0x73,0x20,0x3d,0x1a,0x07,0x71,0x6c,0x4b,0x56,0x05,0x18,0x3f,0x22,0x99,0x84,0xa3,0xbe,0xed,0xf0,0xd7,0xca,0x28,0x35,0x12,0x0f,0x5c,0x41,0x66,0x7b,0xc0,0xdd,0xfa,0xe7,0xb4,0xa9,0x8e,0x93,0xe5,0xf8,0xdf,0xc2,0x91,0x8c,0xab,0xb6,0x0d,0x10,0x37,0x2a,0x79,0x64,0x43,0x5e,0xaf,0xb2,0x95,0x88,0xdb,0xc6,0xe1,0xfc,0x47,0x5a,0x7d,0x60,0x33,0x2e,0x09,0x14,0x62,0x7f,0x58,0x45,0x16,0x0b,0x2c,0x31,0x8a,0x97,0xb0,0xad,0xfe,0xe3,0xc4,0xd9,0x1d,0x00,0x27,0x3a,0x69,0x74,0x53,0x4e,0xf5,0xe8,0xcf,0xd2,0x81,0x9c,0xbb,0xa6,0xd0,0xcd,0xea,0xf7,0xa4,0xb9,0x9e,0x83,0x38,0x25,0x02,0x1f,0x4c,0x51,0x76,0x6b,0x9a,0x87,0xa0,0xbd,0xee,0xf3,0xd4,0xc9,0x72,0x6f,0x48,0x55,0x06,0x1b,0x3c,0x21,0x57,0x4a,0x6d,0x70,0x23,0x3e,0x19,0x04,0xbf,0xa2,0x85,0x98,0xcb,0xd6,0xf1,0xec,0x0e,0x13,0x34,0x29,0x7a,0x67,0x40,0x5d,0xe6,0xfb,0xdc,0xc1,0x92,0x8f,0xa8,0xb5,0xc3,0xde,0xf9,0xe4,0xb7,0xaa,0x8d,0x90,0x2b,0x36,0x11,0x0c,0x5f,0x42,0x65,0x78,0x89,0x94,0xb3,0xae,0xfd,0xe0,0xc7,0xda,0x61,0x7c,0x5b,0x46,0x15,0x08,0x2f,0x32,0x44,0x59,0x7e,0x63,0x30,0x2d,0x0a,0x17,0xac,0xb1,0x96,0x8b,0xd8,0xc5,0xe2,0xff,
};
```





## 3.算法验证

```
#include "crc8_ver3.h"
#include "crc8_ver2.h"
#include <stdio.h>
#include <stdint.h>

int main(void)
{
    char data[4] = {0};
    uint8_t res=0;
    res=calcCRC(data,4);
    printf("0x%02x",res);

    return 0;
}
```

计算结果0x59

```
#include "crc8_ver3.h"
#include "crc8_ver2.h"
#include <stdio.h>
#include <stdint.h>

int main(void)
{
    char data[4] = {0xff,0xff,0xff,0xff};
    uint8_t res=0;
    res=calcCRC(data,4);
    printf("0x%02x",res);

    return 0;
}
```

计算结果0x74



和[CRC-8-SAE J1850 的校验程序](https://blog.csdn.net/qwe775208732/article/details/51810037)参考文章描述吻合

再使用网页验证

[CRC（循环冗余校验）在线计算](http://www.ip33.com/crc.html)

参考配置与结果如下

![](https://cdn.jsdelivr.net/gh/czc13611858691/picgoRepo/image-20211201104810539.png)

和结果吻合

